# é¡¹ç›®å¿«é€Ÿå¯åŠ¨æŒ‡å—

_ä¸€ç«™å¼è·¨å¢ƒç”µå•†ç½‘ç«™é¡¹ç›®åˆå§‹åŒ–_

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿ä½ çš„å¼€å‘ç¯å¢ƒå·²å®‰è£…ï¼š

- Node.js 18+
- npm æˆ– yarn
- Git
- PostgreSQL (æœ¬åœ°å¼€å‘)

### 2. é¡¹ç›®åˆå§‹åŒ–

```bash
# åˆ›å»ºNext.jsé¡¹ç›®
npx create-next-app@latest yoyo-mall --typescript --tailwind --eslint --app --src-dir

# è¿›å…¥é¡¹ç›®ç›®å½•
cd yoyo-mall

# å®‰è£…é¢å¤–ä¾èµ–
npm install @prisma/client prisma zustand next-intl framer-motion react-hook-form @hookform/resolvers zod @radix-ui/react-slot class-variance-authority clsx tailwind-merge lucide-react @next/bundle-analyzer
```

### 3. å…³é”®é…ç½®æ–‡ä»¶

#### package.json (æ·»åŠ è„šæœ¬)

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint --fix",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx,json,md}\"",
    "type-check": "tsc --noEmit",
    "db:generate": "prisma generate",
    "db:push": "prisma db push",
    "db:migrate": "prisma migrate dev",
    "db:seed": "tsx prisma/seed.ts",
    "test": "jest",
    "test:watch": "jest --watch"
  }
}
```

#### .env.local (ç¯å¢ƒå˜é‡)

```env
# æ•°æ®åº“é…ç½®
DATABASE_URL="postgresql://username:password@localhost:5432/yoyomall"

# NextAuthé…ç½®
NEXTAUTH_SECRET="your-super-secret-key-here"
NEXTAUTH_URL="http://localhost:3000"

# æ”¯ä»˜é…ç½®
STRIPE_PUBLIC_KEY="pk_test_your_stripe_public_key"
STRIPE_SECRET_KEY="sk_test_your_stripe_secret_key"
STRIPE_WEBHOOK_SECRET="whsec_your_webhook_secret"

# æ–‡ä»¶å­˜å‚¨
CLOUDINARY_CLOUD_NAME="your_cloud_name"
CLOUDINARY_API_KEY="your_api_key"
CLOUDINARY_API_SECRET="your_api_secret"

# åº”ç”¨é…ç½®
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NEXT_PUBLIC_APP_NAME="YOYO Mall"
```

#### tailwind.config.js

```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ['class'],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    container: {
      center: true,
      padding: '2rem',
      screens: {
        '2xl': '1400px',
      },
    },
    extend: {
      colors: {
        border: 'hsl(var(--border))',
        input: 'hsl(var(--input))',
        ring: 'hsl(var(--ring))',
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        primary: {
          DEFAULT: 'hsl(var(--primary))',
          foreground: 'hsl(var(--primary-foreground))',
        },
        secondary: {
          DEFAULT: 'hsl(var(--secondary))',
          foreground: 'hsl(var(--secondary-foreground))',
        },
        destructive: {
          DEFAULT: 'hsl(var(--destructive))',
          foreground: 'hsl(var(--destructive-foreground))',
        },
        muted: {
          DEFAULT: 'hsl(var(--muted))',
          foreground: 'hsl(var(--muted-foreground))',
        },
        accent: {
          DEFAULT: 'hsl(var(--accent))',
          foreground: 'hsl(var(--accent-foreground))',
        },
        popover: {
          DEFAULT: 'hsl(var(--popover))',
          foreground: 'hsl(var(--popover-foreground))',
        },
        card: {
          DEFAULT: 'hsl(var(--card))',
          foreground: 'hsl(var(--card-foreground))',
        },
      },
      borderRadius: {
        lg: 'var(--radius)',
        md: 'calc(var(--radius) - 2px)',
        sm: 'calc(var(--radius) - 4px)',
      },
      keyframes: {
        'accordion-down': {
          from: { height: 0 },
          to: { height: 'var(--radix-accordion-content-height)' },
        },
        'accordion-up': {
          from: { height: 'var(--radix-accordion-content-height)' },
          to: { height: 0 },
        },
      },
      animation: {
        'accordion-down': 'accordion-down 0.2s ease-out',
        'accordion-up': 'accordion-up 0.2s ease-out',
      },
    },
  },
  plugins: [require('tailwindcss-animate'), require('@tailwindcss/typography')],
};
```

### 4. æ•°æ®åº“é…ç½®

#### prisma/schema.prisma

```prisma
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ç”¨æˆ·æ¨¡å‹
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String?
  avatar    String?
  role      UserRole @default(CUSTOMER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // å…³è”å…³ç³»
  profile   UserProfile?
  addresses Address[]
  orders    Order[]
  reviews   Review[]
  wishlist  WishlistItem[]

  @@map("users")
}

// ç”¨æˆ·æ¡£æ¡ˆ
model UserProfile {
  id          String    @id @default(cuid())
  userId      String    @unique
  firstName   String?
  lastName    String?
  phone       String?
  dateOfBirth DateTime?
  gender      Gender?
  locale      String    @default("zh-CN")
  timezone    String    @default("Asia/Shanghai")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

// åœ°å€æ¨¡å‹
model Address {
  id           String      @id @default(cuid())
  userId       String
  type         AddressType @default(SHIPPING)
  firstName    String
  lastName     String
  company      String?
  addressLine1 String
  addressLine2 String?
  city         String
  state        String
  postalCode   String
  country      String
  phone        String?
  isDefault    Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders Order[]

  @@map("addresses")
}

// å•†å“åˆ†ç±»
model Category {
  id          String @id @default(cuid())
  name        String
  slug        String @unique
  description String?
  image       String?
  parentId    String?
  isActive    Boolean @default(true)
  sortOrder   Int     @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  parent   Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children Category[] @relation("CategoryHierarchy")
  products Product[]

  @@map("categories")
}

// å•†å“æ¨¡å‹
model Product {
  id          String        @id @default(cuid())
  name        String
  slug        String        @unique
  description String?
  shortDesc   String?
  sku         String        @unique
  price       Decimal       @db.Decimal(10, 2)
  comparePrice Decimal?     @db.Decimal(10, 2)
  currency    String        @default("USD")
  weight      Decimal?      @db.Decimal(8, 2)
  dimensions  String?
  categoryId  String
  brandId     String?
  status      ProductStatus @default(DRAFT)
  isDigital   Boolean       @default(false)
  trackInventory Boolean    @default(true)
  allowOutOfStock Boolean   @default(false)
  metaTitle   String?
  metaDesc    String?
  tags        String[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  category     Category       @relation(fields: [categoryId], references: [id])
  brand        Brand?         @relation(fields: [brandId], references: [id])
  images       ProductImage[]
  variants     ProductVariant[]
  inventory    Inventory?
  reviews      Review[]
  orderItems   OrderItem[]
  wishlistItems WishlistItem[]

  @@map("products")
}

// å“ç‰Œæ¨¡å‹
model Brand {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  logo        String?
  website     String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  products Product[]

  @@map("brands")
}

// å•†å“å›¾ç‰‡
model ProductImage {
  id        String @id @default(cuid())
  productId String
  url       String
  alt       String?
  sortOrder Int    @default(0)
  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
}

// å•†å“å˜ä½“
model ProductVariant {
  id          String  @id @default(cuid())
  productId   String
  name        String
  sku         String  @unique
  price       Decimal @db.Decimal(10, 2)
  comparePrice Decimal? @db.Decimal(10, 2)
  weight      Decimal? @db.Decimal(8, 2)
  isActive    Boolean @default(true)
  sortOrder   Int     @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  product     Product           @relation(fields: [productId], references: [id], onDelete: Cascade)
  attributes  VariantAttribute[]
  inventory   Inventory?
  orderItems  OrderItem[]

  @@map("product_variants")
}

// å˜ä½“å±æ€§
model VariantAttribute {
  id        String @id @default(cuid())
  variantId String
  name      String
  value     String
  createdAt DateTime @default(now())

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([variantId, name])
  @@map("variant_attributes")
}

// åº“å­˜ç®¡ç†
model Inventory {
  id              String @id @default(cuid())
  productId       String? @unique
  variantId       String? @unique
  quantity        Int     @default(0)
  reservedQuantity Int    @default(0)
  lowStockThreshold Int   @default(10)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  product Product?        @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@map("inventory")
}

// è®¢å•æ¨¡å‹
model Order {
  id             String      @id @default(cuid())
  orderNumber    String      @unique
  userId         String
  status         OrderStatus @default(PENDING)
  currency       String      @default("USD")
  subtotal       Decimal     @db.Decimal(10, 2)
  taxAmount      Decimal     @db.Decimal(10, 2) @default(0)
  shippingAmount Decimal     @db.Decimal(10, 2) @default(0)
  discountAmount Decimal     @db.Decimal(10, 2) @default(0)
  totalAmount    Decimal     @db.Decimal(10, 2)
  shippingAddressId String?
  billingAddressId  String?
  notes          String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  user            User          @relation(fields: [userId], references: [id])
  shippingAddress Address?      @relation(fields: [shippingAddressId], references: [id])
  items           OrderItem[]
  payments        Payment[]
  shipments       Shipment[]

  @@map("orders")
}

// è®¢å•é¡¹
model OrderItem {
  id           String  @id @default(cuid())
  orderId      String
  productId    String?
  variantId    String?
  quantity     Int
  unitPrice    Decimal @db.Decimal(10, 2)
  totalPrice   Decimal @db.Decimal(10, 2)
  productSnapshot Json  // ä¿å­˜ä¸‹å•æ—¶çš„å•†å“ä¿¡æ¯
  createdAt    DateTime @default(now())

  order   Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product?        @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])

  @@map("order_items")
}

// æ”¯ä»˜è®°å½•
model Payment {
  id              String        @id @default(cuid())
  orderId         String
  paymentMethod   PaymentMethod
  provider        String        // stripe, paypal, etc.
  providerTransactionId String?
  amount          Decimal       @db.Decimal(10, 2)
  currency        String
  status          PaymentStatus @default(PENDING)
  metadata        Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payments")
}

// ç‰©æµä¿¡æ¯
model Shipment {
  id             String         @id @default(cuid())
  orderId        String
  trackingNumber String?
  carrier        String?
  method         String?
  status         ShipmentStatus @default(PENDING)
  shippedAt      DateTime?
  deliveredAt    DateTime?
  metadata       Json?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("shipments")
}

// å•†å“è¯„ä»·
model Review {
  id        String @id @default(cuid())
  productId String
  userId    String
  rating    Int    // 1-5 stars
  title     String?
  content   String?
  images    String[]
  isVerified Boolean @default(false)
  isPublished Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([productId, userId])
  @@map("reviews")
}

// å¿ƒæ„¿å•
model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("wishlist_items")
}

// æšä¸¾ç±»å‹
enum UserRole {
  CUSTOMER
  ADMIN
  SUPER_ADMIN
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum AddressType {
  SHIPPING
  BILLING
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentMethod {
  CREDIT_CARD
  PAYPAL
  BANK_TRANSFER
  APPLE_PAY
  GOOGLE_PAY
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum ShipmentStatus {
  PENDING
  PROCESSING
  SHIPPED
  IN_TRANSIT
  DELIVERED
  RETURNED
}
```

### 5. åŸºç¡€ç»„ä»¶åˆ›å»º

#### src/lib/utils.ts

```typescript
import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

export function formatPrice(
  price: number | string,
  currency: string = 'USD',
  locale: string = 'en-US',
) {
  return new Intl.NumberFormat(locale, {
    style: 'currency',
    currency,
  }).format(Number(price));
}

export function formatDate(date: Date | string, locale: string = 'zh-CN') {
  return new Intl.DateTimeFormat(locale, {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(new Date(date));
}

export function slugify(text: string): string {
  return text
    .toString()
    .toLowerCase()
    .trim()
    .replace(/\s+/g, '-')
    .replace(/[^\w\-]+/g, '')
    .replace(/\-\-+/g, '-')
    .replace(/^-+/, '')
    .replace(/-+$/, '');
}

export function generateOrderNumber(): string {
  const timestamp = Date.now().toString().slice(-8);
  const random = Math.random().toString(36).substring(2, 6).toUpperCase();
  return `ORD-${timestamp}-${random}`;
}

export function calculateDiscount(
  originalPrice: number,
  discountedPrice: number,
): { amount: number; percentage: number } {
  const amount = originalPrice - discountedPrice;
  const percentage = Math.round((amount / originalPrice) * 100);
  return { amount, percentage };
}
```

### 6. åŸºç¡€é…ç½®å®Œæˆåçš„å¯åŠ¨æ­¥éª¤

```bash
# 1. æ•°æ®åº“è®¾ç½®
npm run db:generate
npm run db:push

# 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 3. è®¿é—®åº”ç”¨
# http://localhost:3000
```

## ğŸ¯ å¼€å‘ä¼˜å…ˆçº§å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŸºç¡€ (1-2å‘¨)

1. **é¡¹ç›®ç»“æ„æ­å»º**
   - å®Œæˆä¸Šè¿°æ‰€æœ‰é…ç½®
   - åˆ›å»ºåŸºç¡€ç»„ä»¶åº“
   - è®¾ç½®è·¯ç”±ç»“æ„

2. **è®¤è¯ç³»ç»Ÿ**
   - ç”¨æˆ·æ³¨å†Œ/ç™»å½•
   - ä¼šè¯ç®¡ç†
   - æƒé™æ§åˆ¶

3. **å•†å“å±•ç¤º**
   - å•†å“åˆ—è¡¨é¡µ
   - å•†å“è¯¦æƒ…é¡µ
   - åˆ†ç±»ç­›é€‰

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½ (2-3å‘¨)

1. **è´­ç‰©è½¦ç³»ç»Ÿ**
   - æ·»åŠ /ç§»é™¤å•†å“
   - æ•°é‡ä¿®æ”¹
   - è´­ç‰©è½¦æŒä¹…åŒ–

2. **è®¢å•ç³»ç»Ÿ**
   - è®¢å•åˆ›å»º
   - è®¢å•ç®¡ç†
   - è®¢å•çŠ¶æ€è¿½è¸ª

3. **æ”¯ä»˜é›†æˆ**
   - Stripeé›†æˆ
   - PayPalé›†æˆ
   - æ”¯ä»˜çŠ¶æ€å¤„ç†

### ç¬¬ä¸‰é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ (2-3å‘¨)

1. **ç®¡ç†åå°**
   - å•†å“ç®¡ç†
   - è®¢å•ç®¡ç†
   - ç”¨æˆ·ç®¡ç†

2. **å›½é™…åŒ–**
   - å¤šè¯­è¨€æ”¯æŒ
   - å¤šå¸ç§æ”¯æŒ
   - åœ°åŒºé€‚é…

3. **æ€§èƒ½ä¼˜åŒ–**
   - å›¾ç‰‡ä¼˜åŒ–
   - ä»£ç åˆ†å‰²
   - ç¼“å­˜ç­–ç•¥

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**

   ```bash
   # æ£€æŸ¥PostgreSQLæ˜¯å¦è¿è¡Œ
   # éªŒè¯DATABASE_URLé…ç½®
   npm run db:push
   ```

2. **ç±»å‹é”™è¯¯**

   ```bash
   # é‡æ–°ç”ŸæˆPrismaå®¢æˆ·ç«¯
   npm run db:generate
   ```

3. **æ ·å¼ä¸ç”Ÿæ•ˆ**
   ```bash
   # æ£€æŸ¥Tailwindé…ç½®
   # é‡å¯å¼€å‘æœåŠ¡å™¨
   npm run dev
   ```

### è°ƒè¯•å»ºè®®

1. **å¼€å‘å·¥å…·**
   - ä½¿ç”¨React DevTools
   - å¯ç”¨Prisma Studio: `npx prisma studio`
   - ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·

2. **æ—¥å¿—è®°å½•**
   - åœ¨å…³é”®ä½ç½®æ·»åŠ console.log
   - ä½¿ç”¨é”™è¯¯è¾¹ç•Œæ•è·ç»„ä»¶é”™è¯¯
   - ç›‘æ§ç½‘ç»œè¯·æ±‚

---

_æŒ‰ç…§è¿™ä¸ªæŒ‡å—ï¼Œä½ å°†æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„è·¨å¢ƒç”µå•†ç½‘ç«™å¼€å‘åŸºç¡€ã€‚è®°ä½è¦æ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´é…ç½®å’Œä¼˜å…ˆçº§ã€‚_
