# 项目快速启动指南

_一站式跨境电商网站项目初始化_

## 🚀 快速开始

### 1. 环境准备

确保你的开发环境已安装：

- Node.js 18+
- npm 或 yarn
- Git
- PostgreSQL (本地开发)

### 2. 项目初始化

```bash
# 创建Next.js项目
npx create-next-app@latest yoyo-mall --typescript --tailwind --eslint --app --src-dir

# 进入项目目录
cd yoyo-mall

# 安装额外依赖
npm install @prisma/client prisma zustand next-intl framer-motion react-hook-form @hookform/resolvers zod @radix-ui/react-slot class-variance-authority clsx tailwind-merge lucide-react @next/bundle-analyzer
```

### 3. 关键配置文件

#### package.json (添加脚本)

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint --fix",
    "format": "prettier --write \"**/*.{ts,tsx,js,jsx,json,md}\"",
    "type-check": "tsc --noEmit",
    "db:generate": "prisma generate",
    "db:push": "prisma db push",
    "db:migrate": "prisma migrate dev",
    "db:seed": "tsx prisma/seed.ts",
    "test": "jest",
    "test:watch": "jest --watch"
  }
}
```

#### .env.local (环境变量)

```env
# 数据库配置
DATABASE_URL="postgresql://username:password@localhost:5432/yoyomall"

# NextAuth配置
NEXTAUTH_SECRET="your-super-secret-key-here"
NEXTAUTH_URL="http://localhost:3000"

# 支付配置
STRIPE_PUBLIC_KEY="pk_test_your_stripe_public_key"
STRIPE_SECRET_KEY="sk_test_your_stripe_secret_key"
STRIPE_WEBHOOK_SECRET="whsec_your_webhook_secret"

# 文件存储
CLOUDINARY_CLOUD_NAME="your_cloud_name"
CLOUDINARY_API_KEY="your_api_key"
CLOUDINARY_API_SECRET="your_api_secret"

# 应用配置
NEXT_PUBLIC_APP_URL="http://localhost:3000"
NEXT_PUBLIC_APP_NAME="YOYO Mall"
```

#### tailwind.config.js

```javascript
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ['class'],
  content: [
    './pages/**/*.{ts,tsx}',
    './components/**/*.{ts,tsx}',
    './app/**/*.{ts,tsx}',
    './src/**/*.{ts,tsx}',
  ],
  theme: {
    container: {
      center: true,
      padding: '2rem',
      screens: {
        '2xl': '1400px',
      },
    },
    extend: {
      colors: {
        border: 'hsl(var(--border))',
        input: 'hsl(var(--input))',
        ring: 'hsl(var(--ring))',
        background: 'hsl(var(--background))',
        foreground: 'hsl(var(--foreground))',
        primary: {
          DEFAULT: 'hsl(var(--primary))',
          foreground: 'hsl(var(--primary-foreground))',
        },
        secondary: {
          DEFAULT: 'hsl(var(--secondary))',
          foreground: 'hsl(var(--secondary-foreground))',
        },
        destructive: {
          DEFAULT: 'hsl(var(--destructive))',
          foreground: 'hsl(var(--destructive-foreground))',
        },
        muted: {
          DEFAULT: 'hsl(var(--muted))',
          foreground: 'hsl(var(--muted-foreground))',
        },
        accent: {
          DEFAULT: 'hsl(var(--accent))',
          foreground: 'hsl(var(--accent-foreground))',
        },
        popover: {
          DEFAULT: 'hsl(var(--popover))',
          foreground: 'hsl(var(--popover-foreground))',
        },
        card: {
          DEFAULT: 'hsl(var(--card))',
          foreground: 'hsl(var(--card-foreground))',
        },
      },
      borderRadius: {
        lg: 'var(--radius)',
        md: 'calc(var(--radius) - 2px)',
        sm: 'calc(var(--radius) - 4px)',
      },
      keyframes: {
        'accordion-down': {
          from: { height: 0 },
          to: { height: 'var(--radix-accordion-content-height)' },
        },
        'accordion-up': {
          from: { height: 'var(--radix-accordion-content-height)' },
          to: { height: 0 },
        },
      },
      animation: {
        'accordion-down': 'accordion-down 0.2s ease-out',
        'accordion-up': 'accordion-up 0.2s ease-out',
      },
    },
  },
  plugins: [require('tailwindcss-animate'), require('@tailwindcss/typography')],
};
```

### 4. 数据库配置

#### prisma/schema.prisma

```prisma
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 用户模型
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String?
  avatar    String?
  role      UserRole @default(CUSTOMER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 关联关系
  profile   UserProfile?
  addresses Address[]
  orders    Order[]
  reviews   Review[]
  wishlist  WishlistItem[]

  @@map("users")
}

// 用户档案
model UserProfile {
  id          String    @id @default(cuid())
  userId      String    @unique
  firstName   String?
  lastName    String?
  phone       String?
  dateOfBirth DateTime?
  gender      Gender?
  locale      String    @default("zh-CN")
  timezone    String    @default("Asia/Shanghai")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

// 地址模型
model Address {
  id           String      @id @default(cuid())
  userId       String
  type         AddressType @default(SHIPPING)
  firstName    String
  lastName     String
  company      String?
  addressLine1 String
  addressLine2 String?
  city         String
  state        String
  postalCode   String
  country      String
  phone        String?
  isDefault    Boolean     @default(false)
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  user   User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders Order[]

  @@map("addresses")
}

// 商品分类
model Category {
  id          String @id @default(cuid())
  name        String
  slug        String @unique
  description String?
  image       String?
  parentId    String?
  isActive    Boolean @default(true)
  sortOrder   Int     @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  parent   Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children Category[] @relation("CategoryHierarchy")
  products Product[]

  @@map("categories")
}

// 商品模型
model Product {
  id          String        @id @default(cuid())
  name        String
  slug        String        @unique
  description String?
  shortDesc   String?
  sku         String        @unique
  price       Decimal       @db.Decimal(10, 2)
  comparePrice Decimal?     @db.Decimal(10, 2)
  currency    String        @default("USD")
  weight      Decimal?      @db.Decimal(8, 2)
  dimensions  String?
  categoryId  String
  brandId     String?
  status      ProductStatus @default(DRAFT)
  isDigital   Boolean       @default(false)
  trackInventory Boolean    @default(true)
  allowOutOfStock Boolean   @default(false)
  metaTitle   String?
  metaDesc    String?
  tags        String[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  category     Category       @relation(fields: [categoryId], references: [id])
  brand        Brand?         @relation(fields: [brandId], references: [id])
  images       ProductImage[]
  variants     ProductVariant[]
  inventory    Inventory?
  reviews      Review[]
  orderItems   OrderItem[]
  wishlistItems WishlistItem[]

  @@map("products")
}

// 品牌模型
model Brand {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  logo        String?
  website     String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  products Product[]

  @@map("brands")
}

// 商品图片
model ProductImage {
  id        String @id @default(cuid())
  productId String
  url       String
  alt       String?
  sortOrder Int    @default(0)
  createdAt DateTime @default(now())

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("product_images")
}

// 商品变体
model ProductVariant {
  id          String  @id @default(cuid())
  productId   String
  name        String
  sku         String  @unique
  price       Decimal @db.Decimal(10, 2)
  comparePrice Decimal? @db.Decimal(10, 2)
  weight      Decimal? @db.Decimal(8, 2)
  isActive    Boolean @default(true)
  sortOrder   Int     @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  product     Product           @relation(fields: [productId], references: [id], onDelete: Cascade)
  attributes  VariantAttribute[]
  inventory   Inventory?
  orderItems  OrderItem[]

  @@map("product_variants")
}

// 变体属性
model VariantAttribute {
  id        String @id @default(cuid())
  variantId String
  name      String
  value     String
  createdAt DateTime @default(now())

  variant ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([variantId, name])
  @@map("variant_attributes")
}

// 库存管理
model Inventory {
  id              String @id @default(cuid())
  productId       String? @unique
  variantId       String? @unique
  quantity        Int     @default(0)
  reservedQuantity Int    @default(0)
  lowStockThreshold Int   @default(10)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  product Product?        @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant ProductVariant? @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@map("inventory")
}

// 订单模型
model Order {
  id             String      @id @default(cuid())
  orderNumber    String      @unique
  userId         String
  status         OrderStatus @default(PENDING)
  currency       String      @default("USD")
  subtotal       Decimal     @db.Decimal(10, 2)
  taxAmount      Decimal     @db.Decimal(10, 2) @default(0)
  shippingAmount Decimal     @db.Decimal(10, 2) @default(0)
  discountAmount Decimal     @db.Decimal(10, 2) @default(0)
  totalAmount    Decimal     @db.Decimal(10, 2)
  shippingAddressId String?
  billingAddressId  String?
  notes          String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt

  user            User          @relation(fields: [userId], references: [id])
  shippingAddress Address?      @relation(fields: [shippingAddressId], references: [id])
  items           OrderItem[]
  payments        Payment[]
  shipments       Shipment[]

  @@map("orders")
}

// 订单项
model OrderItem {
  id           String  @id @default(cuid())
  orderId      String
  productId    String?
  variantId    String?
  quantity     Int
  unitPrice    Decimal @db.Decimal(10, 2)
  totalPrice   Decimal @db.Decimal(10, 2)
  productSnapshot Json  // 保存下单时的商品信息
  createdAt    DateTime @default(now())

  order   Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product Product?        @relation(fields: [productId], references: [id])
  variant ProductVariant? @relation(fields: [variantId], references: [id])

  @@map("order_items")
}

// 支付记录
model Payment {
  id              String        @id @default(cuid())
  orderId         String
  paymentMethod   PaymentMethod
  provider        String        // stripe, paypal, etc.
  providerTransactionId String?
  amount          Decimal       @db.Decimal(10, 2)
  currency        String
  status          PaymentStatus @default(PENDING)
  metadata        Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("payments")
}

// 物流信息
model Shipment {
  id             String         @id @default(cuid())
  orderId        String
  trackingNumber String?
  carrier        String?
  method         String?
  status         ShipmentStatus @default(PENDING)
  shippedAt      DateTime?
  deliveredAt    DateTime?
  metadata       Json?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("shipments")
}

// 商品评价
model Review {
  id        String @id @default(cuid())
  productId String
  userId    String
  rating    Int    // 1-5 stars
  title     String?
  content   String?
  images    String[]
  isVerified Boolean @default(false)
  isPublished Boolean @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([productId, userId])
  @@map("reviews")
}

// 心愿单
model WishlistItem {
  id        String   @id @default(cuid())
  userId    String
  productId String
  createdAt DateTime @default(now())

  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("wishlist_items")
}

// 枚举类型
enum UserRole {
  CUSTOMER
  ADMIN
  SUPER_ADMIN
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum AddressType {
  SHIPPING
  BILLING
}

enum ProductStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentMethod {
  CREDIT_CARD
  PAYPAL
  BANK_TRANSFER
  APPLE_PAY
  GOOGLE_PAY
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum ShipmentStatus {
  PENDING
  PROCESSING
  SHIPPED
  IN_TRANSIT
  DELIVERED
  RETURNED
}
```

### 5. 基础组件创建

#### src/lib/utils.ts

```typescript
import { type ClassValue, clsx } from 'clsx';
import { twMerge } from 'tailwind-merge';

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

export function formatPrice(
  price: number | string,
  currency: string = 'USD',
  locale: string = 'en-US',
) {
  return new Intl.NumberFormat(locale, {
    style: 'currency',
    currency,
  }).format(Number(price));
}

export function formatDate(date: Date | string, locale: string = 'zh-CN') {
  return new Intl.DateTimeFormat(locale, {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  }).format(new Date(date));
}

export function slugify(text: string): string {
  return text
    .toString()
    .toLowerCase()
    .trim()
    .replace(/\s+/g, '-')
    .replace(/[^\w\-]+/g, '')
    .replace(/\-\-+/g, '-')
    .replace(/^-+/, '')
    .replace(/-+$/, '');
}

export function generateOrderNumber(): string {
  const timestamp = Date.now().toString().slice(-8);
  const random = Math.random().toString(36).substring(2, 6).toUpperCase();
  return `ORD-${timestamp}-${random}`;
}

export function calculateDiscount(
  originalPrice: number,
  discountedPrice: number,
): { amount: number; percentage: number } {
  const amount = originalPrice - discountedPrice;
  const percentage = Math.round((amount / originalPrice) * 100);
  return { amount, percentage };
}
```

### 6. 基础配置完成后的启动步骤

```bash
# 1. 数据库设置
npm run db:generate
npm run db:push

# 2. 启动开发服务器
npm run dev

# 3. 访问应用
# http://localhost:3000
```

## 🎯 开发优先级建议

### 第一阶段：核心基础 (1-2周)

1. **项目结构搭建**
   - 完成上述所有配置
   - 创建基础组件库
   - 设置路由结构

2. **认证系统**
   - 用户注册/登录
   - 会话管理
   - 权限控制

3. **商品展示**
   - 商品列表页
   - 商品详情页
   - 分类筛选

### 第二阶段：核心功能 (2-3周)

1. **购物车系统**
   - 添加/移除商品
   - 数量修改
   - 购物车持久化

2. **订单系统**
   - 订单创建
   - 订单管理
   - 订单状态追踪

3. **支付集成**
   - Stripe集成
   - PayPal集成
   - 支付状态处理

### 第三阶段：高级功能 (2-3周)

1. **管理后台**
   - 商品管理
   - 订单管理
   - 用户管理

2. **国际化**
   - 多语言支持
   - 多币种支持
   - 地区适配

3. **性能优化**
   - 图片优化
   - 代码分割
   - 缓存策略

## 🔧 故障排除

### 常见问题

1. **数据库连接失败**

   ```bash
   # 检查PostgreSQL是否运行
   # 验证DATABASE_URL配置
   npm run db:push
   ```

2. **类型错误**

   ```bash
   # 重新生成Prisma客户端
   npm run db:generate
   ```

3. **样式不生效**
   ```bash
   # 检查Tailwind配置
   # 重启开发服务器
   npm run dev
   ```

### 调试建议

1. **开发工具**
   - 使用React DevTools
   - 启用Prisma Studio: `npx prisma studio`
   - 使用浏览器开发者工具

2. **日志记录**
   - 在关键位置添加console.log
   - 使用错误边界捕获组件错误
   - 监控网络请求

---

_按照这个指南，你将拥有一个完整的跨境电商网站开发基础。记住要根据实际需求调整配置和优先级。_
